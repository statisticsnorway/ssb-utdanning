# Fellesfunksjoner for 360
> En test for å se om fellesfunksjonene til hver seksjon kan organiseres som ett nbdev-prosjekt, med undermoduler per tema.


Denne siden fungerer både som readme for githubprosjektet, og forsiden av dokumentasjonen på https://statisticsnorway.github.io/ssb_fellesfunksjoner_360/

## Installering

`pip install ssb_fellesfunksjoner_360`

## Bruk help() på modulene for å lese integrert dokumentasjon

```python
from ssb_fellesfunksjoner_360 import klass, sporre
```

```python
help(klass)
```

    Help on module ssb_fellesfunksjoner_360.klass in ssb_fellesfunksjoner_360:
    
    NAME
        ssb_fellesfunksjoner_360.klass - # AUTOGENERATED! DO NOT EDIT! File to edit: 01_klass.ipynb (unless otherwise specified).
    
    FUNCTIONS
        get_pandas(URL, level)
            Get pandas dataframe from the KLASS-API
            
            Parameters
            ----------
            URL : str 
            
                url to the API-endpoint you are interested in
            level : str 
            
                level of the json to convert, for example 'classificationItems' or 'correspondenceMaps'
            
            Returns
            -------
            pandas.DataFrame() 
            
                The returned json at the level requested, converted to a pandas dataframe
            
            Further Development
            -------
            Error catching when "level" is not found in the returned json, show the top level json-keys then?
    
    DATA
        __all__ = ['get_pandas']
    
    FILE
        /home/jovyan/ssb_fellesfunksjoner_360/ssb_fellesfunksjoner_360/klass.py
    
    


```python
help(sporre)
```

    Help on module ssb_fellesfunksjoner_360.sporre in ssb_fellesfunksjoner_360:
    
    NAME
        ssb_fellesfunksjoner_360.sporre - # AUTOGENERATED! DO NOT EDIT! File to edit: 03_sporre.ipynb (unless otherwise specified).
    
    FUNCTIONS
        avled_tverrvar(codeprefix, coderange, lettercodes, df)
            Denne funksjonen sjekker en bred range av kode-kolonner, og slår disse sammen til en oppsummeringskolonne.
            
            Forutsetningen er at det er lignende svaralternativer på ulike spørsmål som man skal gå gjennom og at de "Or-es", dvs True på 1 er True på den avledete variabelen.
            
            F.eks. 17 spørsmål om fjernsynskanaler, hvor man spør etter 21 ulike programtyper. Og man ønsker å svare på: 'Så denne personen på denne typen program i det hele tatt?'
            
            
            
            Parameters
            ----------
            first "codeprefix" : string
            
                Første parameter er en string som er prefikset til kolonnene, feks. 'fje10_'
            second "coderange" : integer
            
                Andre parameter er ett tall som sier hvor mange kolonner som er nummerert.
                Om du sender 17 så vil den ta alle tallene som er 1-17 og da lage kolonneheadere som 'fje10_17x'
            third "lettercodes" : dict
            
                Det tredje parameteret skal være en dict, som forteller om hvilket svaralternativ skal bli til hvilken nye kolonne.
                feks. 'a' : 'tvsport', hvor svaralternativ 'a' på alle kanaler, skal bli 'eller'-t til en avledet variabelkolonne 'tvsport'
            fourth "df" : Pandas Dataframe
            
                Det fjerde parameteret skal være dataframen som vi opererer på.
            
            Returns
            -------
            DataFrame
            
                Returnerer dataframen som kom inn, med ny avledet kolonne.
            
            Raises
            ------
            ValueError
            
                Om noen av variablene inn ikke stemmer med forventede typer.
                Om dataframen er 0 rader lang.
            KeyError
            
                Om noen av kolonnene det letes i, ikke finnes.
                Om noen av kolonnene som burde vært opprettet, ikke er der på slutten av funksjonen.
    
    DATA
        __all__ = ['avled_tverrvar']
    
    FILE
        /home/jovyan/ssb_fellesfunksjoner_360/ssb_fellesfunksjoner_360/sporre.py
    
    


## Hvordan bruke eksempelfunksjon

Etter å ha importert modulen, så kan du feks bruke denne funksjonen for å hente noe fra KLASS-apiet som en pandas dataframe.

```python
gjeld_fylke = klass.get_pandas(r'http://data.ssb.no/api/klass/v1/versions/1158', 'classificationItems')
gjeld_fylke
```


    ---------------------------------------------------------------------------

    JSONDecodeError                           Traceback (most recent call last)

    <ipython-input-4-45f864010e24> in <module>
    ----> 1 gjeld_fylke = klass.get_pandas(r'http://data.ssb.no/api/klass/v1/versions/1158', 'classificationItems')
          2 gjeld_fylke


    ~/ssb_fellesfunksjoner_360/ssb_fellesfunksjoner_360/klass.py in get_pandas(URL, level)
         33     r = requests.get(URL)
         34     r = r.content.decode('utf8').replace("'", '"')
    ---> 35     r = json.loads(r)
         36     r = pd.json_normalize(r[level])
         37     return r


    /opt/conda/lib/python3.8/json/__init__.py in loads(s, cls, object_hook, parse_float, parse_int, parse_constant, object_pairs_hook, **kw)
        355             parse_int is None and parse_float is None and
        356             parse_constant is None and object_pairs_hook is None and not kw):
    --> 357         return _default_decoder.decode(s)
        358     if cls is None:
        359         cls = JSONDecoder


    /opt/conda/lib/python3.8/json/decoder.py in decode(self, s, _w)
        335 
        336         """
    --> 337         obj, end = self.raw_decode(s, idx=_w(s, 0).end())
        338         end = _w(s, end).end()
        339         if end != len(s):


    /opt/conda/lib/python3.8/json/decoder.py in raw_decode(self, s, idx)
        351         """
        352         try:
    --> 353             obj, end = self.scan_once(s, idx)
        354         except StopIteration as err:
        355             raise JSONDecodeError("Expecting value", s, err.value) from None


    JSONDecodeError: Expecting ',' delimiter: line 1 column 5660 (char 5659)

